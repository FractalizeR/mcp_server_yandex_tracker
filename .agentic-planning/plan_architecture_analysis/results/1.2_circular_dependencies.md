# Circular Dependencies Analysis

**–î–∞—Ç–∞:** 2025-11-21
**–ê–≤—Ç–æ—Ä:** Claude Code

---

## üéØ –¶–µ–ª—å

–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤ –ø—Ä–æ–µ–∫—Ç–µ (–∏–ª–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —á—Ç–æ –≤—Å–µ —Ü–∏–∫–ª—ã —è–≤–ª—è—é—Ç—Å—è –Ω–∞–º–µ—Ä–µ–Ω–Ω—ã–º–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–º–∏).

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã dependency-cruiser

```bash
npx depcruise packages --config .dependency-cruiser.cjs --output-type err
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úî no dependency violations found (577 modules, 1740 dependencies cruised)
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ PASS - –ù–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–π –ø—Ä–∞–≤–∏–ª —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## üìã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤

–°–æ–≥–ª–∞—Å–Ω–æ `.dependency-cruiser.cjs`, —Å–ª–µ–¥—É—é—â–∏–µ —Ü–∏–∫–ª—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã (severity: warn):

### 1. BaseDefinition ‚Üî ToolMetadata (Framework Pattern)

**–§–∞–π–ª—ã:**
- `packages/core/src/tools/base/base-definition.ts`
- `packages/core/src/tools/base/tool-metadata.ts`

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –≠—Ç–æ –Ω–∞–º–µ—Ä–µ–Ω–Ω—ã–π framework –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è Definition —Å Metadata

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ (framework pattern)

---

### 2. SearchToolsDefinition ‚Üî SearchToolsTool (Pairing Pattern)

**–§–∞–π–ª—ã:**
- `packages/search/src/tools/search-tools.definition.ts`
- `packages/search/src/tools/search-tools.tool.ts`

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ü–∞—Ç—Ç–µ—Ä–Ω "Definition-Tool pairing" - Definition –∏ Tool –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ (pairing pattern)

---

### 3. DemoDefinition ‚Üî DemoTool (Pairing Pattern)

**–§–∞–π–ª—ã:**
- `packages/servers/yandex-tracker/src/tools/helpers/demo/demo.definition.ts`
- `packages/servers/yandex-tracker/src/tools/helpers/demo/demo.tool.ts`

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ü–∞—Ç—Ç–µ—Ä–Ω "Definition-Tool pairing" - Definition –∏ Tool –≤–∑–∞–∏–º–æ—Å–≤—è–∑–∞–Ω—ã

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–∞–∑—Ä–µ—à–µ–Ω–æ (pairing pattern)

---

## üîç –ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ madge

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
npx madge --circular packages/framework/infrastructure/src --extensions ts
npx madge --circular packages/framework/core/src --extensions ts
npx madge --circular packages/framework/search/src --extensions ts
npx madge --circular packages/servers/yandex-tracker/src --extensions ts
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** madge –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** dependency-cruiser —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏–ª –ø–æ–ª–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É (577 –º–æ–¥—É–ª–µ–π), madge –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

---

## üìä –ü—Ä–∞–≤–∏–ª–∞ dependency-cruiser –¥–ª—è —Ü–∏–∫–ª–æ–≤

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `no-circular`:

```javascript
{
  name: 'no-circular',
  severity: 'warn',
  comment: '–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∑–∞–ø—Ä–µ—â–µ–Ω—ã',
  from: {
    pathNot: [
      '^node_modules',
      // –ò—Å–∫–ª—é—á–µ–Ω–∏—è: –Ω–∞–º–µ—Ä–µ–Ω–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω Definition‚ÜîTool
      '^packages/core/src/tools/base/base-definition\\.ts$',
      '^packages/core/src/tools/base/tool-metadata\\.ts$',
      '^packages/search/src/tools/search-tools\\.definition\\.ts$',
      '^packages/search/src/tools/search-tools\\.tool\\.ts$',
      '^packages/(yandex-tracker|servers/yandex-tracker)/src/tools/helpers/demo/demo\\.definition\\.ts$',
      '^packages/(yandex-tracker|servers/yandex-tracker)/src/tools/helpers/demo/demo\\.tool\\.ts$',
    ],
  },
  to: {
    pathNot: '^node_modules',
    circular: true,
  },
}
```

**Severity:** `warn` (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç build, –Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ)

---

## üí° –í—ã–≤–æ–¥—ã

### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

1. **–ù–µ—Ç —Å–ª—É—á–∞–π–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤:** –í—Å–µ 577 –º–æ–¥—É–ª–µ–π –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã, –Ω–µ—Ç –Ω–µ–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
2. **–ù–∞–º–µ—Ä–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã:** –í—Å–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã —è–≤–Ω–æ —É–∫–∞–∑–∞–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. **–ß–µ—Ç–∫–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ö–∞–∂–¥—ã–π —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∏–º–µ–µ—Ç –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ (framework/pairing pattern)
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** CI/CD –±—É–¥–µ—Ç –ª–æ–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ü–∏–∫–ª—ã

### üéØ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –æ—Ü–µ–Ω–∫–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ | –°—Ç–∞—Ç—É—Å |
|---------|------------------|-------------|--------|
| –ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ | 0 | 0 | ‚úÖ PASS |
| –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ | –ú–∏–Ω–∏–º—É–º | 3 | ‚úÖ PASS |
| –ù–∞—Ä—É—à–µ–Ω–∏–π no-circular | 0 | 0 | ‚úÖ PASS |

---

## üìã –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### üü¢ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ

**–ù–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏–ª–∏ –≤–∞–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º.**

–¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º.

#### –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å madge –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏:**
   - **–û–ø–∏—Å–∞–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å madge –≤ devDependencies –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä–∞—Ñ–æ–≤
   - **Effort:** LOW (~10 –º–∏–Ω—É—Ç)
   - **Impact:** LOW (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–µ–∑–Ω–∞ –¥–ª—è onboarding)
   - **–ö–æ–º–∞–Ω–¥–∞:**
     ```bash
     npm install --save-dev madge
     npm run graph:circular  # —Å–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç
     ```

2. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Definition‚ÜîTool:**
   - **–û–ø–∏—Å–∞–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ –≤ ARCHITECTURE.md
   - **Effort:** LOW (~30 –º–∏–Ω—É—Ç)
   - **Impact:** MEDIUM (—É–ª—É—á—à–∞–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã)

---

## üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–∞—Ö

### –ü–∞—Ç—Ç–µ—Ä–Ω Definition‚ÜîTool

**–ü–æ—á–µ–º—É —ç—Ç–æ –Ω–µ –ø—Ä–æ–±–ª–µ–º–∞:**

1. **By Design:** –≠—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è Definition –∏ Tool
2. **Type-level —Ç–æ–ª—å–∫–æ:** –¶–∏–∫–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∏–ø–æ–≤, –Ω–µ runtime
3. **–ú–∞–ª—ã–π scope:** –¶–∏–∫–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –¥–≤—É–º—è —Ñ–∞–π–ª–∞–º–∏ (Definition + Tool)
4. **–ù–µ—Ç side effects:** –ù–µ—Ç runtime –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π —á–∞—Å—Ç–∏

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã (–ø–æ—á–µ–º—É –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º):**

- **Separate types file:** –°–æ–∑–¥–∞—Å—Ç –∏–∑–ª–∏—à–Ω—é—é —Å–ª–æ–∂–Ω–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –ø–∞—Ç—Ç–µ—Ä–Ω–∞
- **–ò–Ω–≤–µ—Ä—Å–∏—è —á–µ—Ä–µ–∑ registry:** –ò–∑–±—ã—Ç–æ—á–Ω–æ –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–≤—è–∑—ã–≤–∞–Ω–∏—è
- **Builder pattern:** –î–æ–±–∞–≤–∏—Ç boilerplate –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –≤—ã–≥–æ–¥—ã

**Trade-off:** –ù–µ–±–æ–ª—å—à–æ–π —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–π –∏–º–ø–æ—Ä—Ç —Ç–∏–ø–æ–≤ vs –ø—Ä–æ—Å—Ç–æ—Ç–∞ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞

**–†–µ—à–µ–Ω–∏–µ:** ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (pragmatic approach)

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å baseline

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª–µ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ | –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ | –°—Ç–∞—Ç—É—Å |
|---------|------------------|-------------|--------|
| –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥—É–ª–µ–π | N/A | 577 | ‚ÑπÔ∏è INFO |
| –ü—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ | 0 | 0 | ‚úÖ PASS |
| –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤ | ‚â§5 | 3 | ‚úÖ PASS |
| –¶–∏–∫–ª–æ–≤ –º–µ–∂–¥—É –ø–∞–∫–µ—Ç–∞–º–∏ | 0 | 0 | ‚úÖ PASS |

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ dependency-cruiser
- [x] –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [x] –û—Ü–µ–Ω–∫–∞ trade-offs
- [ ] –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∞–Ω–∞–ª–∏–∑—É –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—Å–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞)
