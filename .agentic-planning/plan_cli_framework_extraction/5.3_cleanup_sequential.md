# 5.3 Cleanup дублирующегося кода (после feature flags)

**Тип:** Sequential
**Зависимости:** 5.5 Feature Flags ⚠️ ИЗМЕНЕНО
**Время:** ~20 минут
**Критичность:** НИЗКАЯ — можно отложить

---

## ⚠️ ВАЖНОЕ ИЗМЕНЕНИЕ

**Этот этап теперь НЕ критичен** и может быть выполнен позже (после полного тестирования новой версии).

**Старый подход:** Удалить legacy код сразу после миграции
**Новый подход:** Сохранить legacy код для возможности отката (этап 5.5)

---

## Задача

Минимальная cleanup — удалить только дублирующийся код, который точно не нужен. Legacy CLI код НЕ трогаем (он в `cli-legacy/`).

---

## Действия

### 1. Идентифицировать файлы для удаления

**Удалить из `packages/servers/yandex-tracker/src/cli/`:**
- ✅ `connectors/` — все (теперь в framework)
- ✅ `commands/` — все (теперь в framework)
- ✅ `utils/` — все (теперь в framework)

**Оставить:**
- ❌ `bin/mcp-connect.ts` — entry point (обновлен в 5.1)
- ❌ `types.ts` — YT-специфичные типы
- ❌ `prompts.ts` — YT-специфичные промпты
- ❌ `README.md` — документация

### 2. Удалить старый код

```bash
cd packages/servers/yandex-tracker/src/cli

# Удалить connectors
rm -rf connectors/

# Удалить команды
rm -rf commands/

# Удалить утилиты
rm -rf utils/
```

### 3. Проверить структуру

**Финальная структура:**
```
packages/servers/yandex-tracker/src/cli/
├── bin/
│   └── mcp-connect.ts      (использует @mcp-framework/cli)
├── types.ts                (YT-специфичные типы)
├── prompts.ts              (YT-специфичные промпты)
└── README.md               (обновленная документация)
```

### 4. Обновить README.md

**Файл:** `packages/servers/yandex-tracker/src/cli/README.md`

```markdown
# Yandex Tracker CLI

CLI использует `@mcp-framework/cli` для управления подключениями к MCP клиентам.

## Использование

```bash
npm run mcp:connect     # подключить
npm run mcp:disconnect  # отключить
npm run mcp:status      # статус
npm run mcp:list        # список клиентов
```

## Конфигурация

Yandex Tracker требует:
- `token` — OAuth токен (секрет, не сохраняется)
- `orgId` — ID организации (сохраняется)
- `apiBase` — URL API (опционально)
- `logLevel` — Уровень логирования

Подробности: `src/cli/types.ts` и `src/cli/prompts.ts`

## Архитектура

CLI построен на `@mcp-framework/cli`.

Документация: [packages/framework/cli/README.md](../../../framework/cli/README.md)
```

### 5. Проверить импорты

**Убедиться, что нигде не осталось импортов из старого CLI:**

```bash
cd packages/servers/yandex-tracker
grep -r "from.*cli/connectors" src/
grep -r "from.*cli/commands" src/
grep -r "from.*cli/utils" src/
```

**Ожидаемый результат:** Нет найденных импортов (кроме bin/mcp-connect.ts)

### 6. Запустить валидацию

```bash
npm run validate
```

---

## Результат

- [ ] Старые файлы удалены (connectors, commands, utils)
- [ ] Структура CLI минимальна (bin, types, prompts, README)
- [ ] README обновлен
- [ ] Нет сломанных импортов
- [ ] `npm run validate` проходит

---

## Критерии готовности

- [ ] Все перенесенные файлы удалены из yandex-tracker
- [ ] Остались только YT-специфичные файлы
- [ ] README обновлен и уменьшен
- [ ] Нет ошибок компиляции
- [ ] Все тесты проходят
