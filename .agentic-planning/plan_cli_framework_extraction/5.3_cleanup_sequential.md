# 5.3 Удаление старого кода

**Тип:** Sequential
**Зависимости:** 5.2 Обновление зависимостей
**Время:** ~30 минут

---

## Задача

Удалить старый CLI код из yandex-tracker, который теперь находится в framework/cli.

---

## Действия

### 1. Идентифицировать файлы для удаления

**Удалить из `packages/servers/yandex-tracker/src/cli/`:**
- ✅ `connectors/base/` — все базовые классы (теперь в framework)
- ✅ `connectors/claude-desktop/` — коннектор (теперь в framework)
- ✅ `connectors/claude-code/` — коннектор (теперь в framework)
- ✅ `connectors/codex/` — коннектор (теперь в framework)
- ✅ `connectors/gemini/` — коннектор (теперь в framework)
- ✅ `connectors/qwen/` — коннектор (теперь в framework)
- ✅ `connectors/registry.ts` — реестр (теперь в framework)
- ✅ `commands/connect.command.ts` — команда (теперь в framework)
- ✅ `commands/disconnect.command.ts` — команда (теперь в framework)
- ✅ `commands/status.command.ts` — команда (теперь в framework)
- ✅ `commands/list.command.ts` — команда (теперь в framework)
- ✅ `commands/validate.command.ts` — (если перенесли в framework)
- ✅ `utils/command-executor.ts` — утилита (теперь в framework)
- ✅ `utils/file-manager.ts` — утилита (теперь в framework)
- ✅ `utils/logger.ts` — утилита (теперь в framework)
- ✅ `utils/config-manager.ts` — утилита (теперь в framework)
- ✅ `utils/interactive-prompter.ts` — утилита (теперь в framework)

**Оставить в `packages/servers/yandex-tracker/src/cli/`:**
- ❌ `bin/mcp-connect.ts` — entry point (обновлен в 5.1)
- ❌ `types.ts` — YT-специфичные типы (создан в 5.1)
- ❌ `prompts.ts` — YT-специфичные промпты (создан в 5.1)
- ❌ `README.md` — документация (нужно обновить)

### 2. Удалить файлы

```bash
cd packages/servers/yandex-tracker/src/cli

# Удалить connectors (кроме index если нужен)
rm -rf connectors/

# Удалить команды
rm -rf commands/

# Удалить утилиты
rm -rf utils/
```

### 3. Проверить структуру после удаления

**Ожидаемая структура:**
```
packages/servers/yandex-tracker/src/cli/
├── bin/
│   └── mcp-connect.ts      (использует @mcp-framework/cli)
├── types.ts                (YT-специфичные типы)
├── prompts.ts              (YT-специфичные промпты)
└── README.md               (обновленная документация)
```

### 4. Обновить README.md

**Файл:** `packages/servers/yandex-tracker/src/cli/README.md`

**Изменения:**
- Указать, что CLI теперь использует `@mcp-framework/cli`
- Ссылка на framework/cli документацию
- Показать только YT-специфичную конфигурацию (типы и промпты)
- Уменьшить размер документа (много было описания коннекторов)

**Примерное содержание:**
```markdown
# Yandex Tracker CLI

Этот CLI использует `@mcp-framework/cli` для управления подключениями к MCP клиентам.

## Использование

См. корневой README для установки. Команды:

- `npm run mcp:connect` — подключить к клиенту
- `npm run mcp:disconnect` — отключить от клиента
- `npm run mcp:status` — статус подключений
- `npm run mcp:list` — список клиентов

## Конфигурация

Yandex Tracker требует следующие параметры:

- `token` — OAuth токен Яндекс.Трекера (секрет, не сохраняется)
- `orgId` — ID организации (сохраняется)
- `apiBase` — Базовый URL API (опционально, сохраняется)
- `requestTimeout` — Таймаут запросов (опционально)
- `logLevel` — Уровень логирования

Подробности: см. `src/cli/types.ts` и `src/cli/prompts.ts`

## Архитектура

CLI построен на `@mcp-framework/cli` — универсальном framework для MCP подключений.

Подробнее: [packages/framework/cli/README.md](../../../framework/cli/README.md)
```

### 5. Проверить импорты в yandex-tracker

**Убедиться, что нигде не осталось импортов из старого CLI:**

```bash
cd packages/servers/yandex-tracker
grep -r "from.*cli/connectors" src/
grep -r "from.*cli/commands" src/
grep -r "from.*cli/utils" src/
```

**Ожидаемый результат:** Нет найденных импортов (кроме bin/mcp-connect.ts)

### 6. Запустить валидацию

```bash
cd packages/servers/yandex-tracker
npm run validate
```

**Ожидаемый результат:** Все проверки проходят

---

## Результат

- [ ] Старые файлы удалены
- [ ] Структура CLI минимальна (bin, types, prompts, README)
- [ ] README обновлен
- [ ] Нет сломанных импортов
- [ ] `npm run validate` проходит

---

## Критерии готовности

- [ ] Все перенесенные файлы удалены из yandex-tracker
- [ ] Остались только YT-специфичные файлы
- [ ] README обновлен и уменьшен
- [ ] Нет ошибок компиляции
- [ ] Все тесты проходят
