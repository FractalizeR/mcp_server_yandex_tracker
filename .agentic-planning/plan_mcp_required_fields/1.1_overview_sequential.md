# План: Добавление обязательного параметра `fields` во все MCP tools

## Обзор задачи

**Цель:** Во всех MCP инструментах явно указывать перечень полей, которые возвращаются в результате. Параметр `fields` должен быть **обязательным**.

**Проблема:**
- 27 из 47 MCP tools возвращают полные объекты API без фильтрации
- Это засоряет контекст Claude (до 90% избыточных данных)
- Параметр `fields` либо отсутствует, либо опциональный

**Решение:**
- Добавить обязательный параметр `fields: string[]` в schema
- Использовать `ResponseFieldFilter.filter()` для фильтрации ответов
- Применить во ВСЕХ операциях, возвращающих объекты (get, create, update, add, edit)

---

## Статистика

- **Всего tools:** 47
- **✅ Уже правильно (с fields):** 7 tools (15%)
- **⚠️ НУЖНО исправить:** 27 tools (57%)
- **✅ НЕ нужно (binary/void):** 13 tools (28%)

---

## Критерии приемки

Для каждого из 27 tools:

### 1. Schema файл (`*.schema.ts`)
- [ ] Добавлен обязательный параметр `fields: FieldsSchema`
- [ ] Импортирован `FieldsSchema` из `@mcp-framework/core` или `common/schemas`
- [ ] НЕТ `.optional()` - параметр строго обязательный

### 2. Tool файл (`*.tool.ts`)
- [ ] Импортирован `ResponseFieldFilter` из `@mcp-framework/core`
- [ ] Извлекается `fields` из validated params
- [ ] Используется `ResponseFieldFilter.filter(data, fields)` перед возвратом
- [ ] Убрана любая ручная фильтрация полей (если была)
- [ ] В ответе указывается `fieldsReturned: fields` для информирования

### 3. Definition файл (`*.definition.ts`)
- [ ] Обновлено описание с упоминанием обязательности `fields`
- [ ] Добавлены примеры использования параметра `fields`

### 4. Тесты
- [ ] Обновлены существующие тесты (добавлен параметр `fields`)
- [ ] Добавлены тесты на фильтрацию полей (если отсутствуют)
- [ ] Проверка, что без `fields` tool возвращает ошибку валидации

---

## Структура плана

План разбит на независимые этапы по категориям API:

- **1.2** - Подготовка общих компонентов (sequential)
- **2.x** - Категории tools (можно выполнять параллельно):
  - **2.1** - Checklists (4 tools)
  - **2.2** - Comments (3 tools)
  - **2.3** - Components (3 tools)
  - **2.4** - Attachments (2 tools)
  - **2.5** - Links (2 tools)
  - **2.6** - Projects (4 tools)
  - **2.7** - Queues (6 tools)
  - **2.8** - Worklogs (3 tools)
- **3.1** - Валидация и тестирование (sequential)
- **4.1** - Документация (sequential)

---

## Зависимости между этапами

```
1.2 (Подготовка)
  ↓
2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8 (Параллельно)
  ↓
3.1 (Валидация)
  ↓
4.1 (Документация)
```

**Параллельность:** Этапы 2.1-2.8 можно выполнять одновременно в разных ветках разными ИИ агентами.

---

## Следующий шаг

После согласования плана, переходить к этапу **1.2_preparation_sequential.md**
