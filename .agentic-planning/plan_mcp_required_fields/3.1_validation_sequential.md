# 3.1 Валидация и тестирование (Sequential)

**Тип:** Sequential (выполняется после завершения всех параллельных этапов 2.1-2.8)

**Цель:** Убедиться, что все изменения корректны, тесты проходят, нет регрессий.

---

## Задачи

### 1. TypeScript компиляция

- [ ] Запустить `npm run build` в корне monorepo
- [ ] Убедиться, что нет ошибок компиляции
- [ ] Проверить, что все импорты резолвятся корректно

```bash
cd /home/user/mcp_server_yandex_tracker
npm run build
```

**Ожидаемый результат:** Build успешен для всех workspaces

---

### 2. Type checking

- [ ] Запустить `npm run typecheck` для yandex-tracker пакета
- [ ] Убедиться в отсутствии type errors

```bash
npm run typecheck --workspace=@mcp-server/yandex-tracker
```

**Ожидаемый результат:** No type errors

---

### 3. Linting

- [ ] Запустить `npm run lint:quiet` для yandex-tracker
- [ ] Исправить все ошибки lint (если есть)

```bash
npm run lint:quiet --workspace=@mcp-server/yandex-tracker
```

**Ожидаемый результат:** No linting errors

---

### 4. Тестирование

- [ ] Запустить все тесты в quiet режиме
- [ ] Убедиться, что все 455+ тестов проходят
- [ ] Проверить покрытие (должно остаться ≥90%)

```bash
npm run test:quiet --workspace=@mcp-server/yandex-tracker
```

**Ожидаемый результат:**
- ✓ 455+ тестов проходят
- Coverage: Lines ≥90%, Branches ≥85%

---

### 5. Smoke testing

- [ ] Запустить smoke тесты (если есть)
- [ ] Проверить базовый сценарий работы MCP сервера

```bash
npm run test:smoke --workspace=@mcp-server/yandex-tracker
```

---

### 6. Проверка дублирования кода

- [ ] Запустить `npm run cpd:quiet`
- [ ] Убедиться, что уровень дублирования ≤5%

```bash
npm run cpd:quiet
```

---

### 7. Валидация всего monorepo

- [ ] Запустить полную валидацию в quiet режиме

```bash
npm run validate:quiet
```

**Ожидаемый результат:** Все проверки проходят

---

### 8. Ручная проверка примеров

Выборочно проверить несколько tools вручную:

#### get_projects (было БЕЗ fields)

```typescript
// ДО (это должно УПАСТЬ с ошибкой валидации):
await getTool('get_projects').execute({ perPage: 10 });

// ПОСЛЕ (это должно работать):
await getTool('get_projects').execute({
  perPage: 10,
  fields: ['id', 'name', 'description']
});
```

#### add_comment (было БЕЗ fields)

```typescript
// ПОСЛЕ:
await getTool('add_comment').execute({
  issueId: 'TEST-1',
  text: 'Test comment',
  fields: ['id', 'text', 'createdAt']
});
```

---

### 9. Проверка качества кода

- [ ] Запустить метрики сложности
- [ ] Убедиться, что не превышены лимиты (complexity ≤10, cognitive ≤15)

```bash
npm run quality
```

---

### 10. Финальный чеклист

- [ ] ✅ Все 27 tools имеют обязательный параметр `fields`
- [ ] ✅ Все tools используют `ResponseFieldFilter`
- [ ] ✅ Удалена вся ручная фильтрация полей
- [ ] ✅ Все тесты обновлены и проходят
- [ ] ✅ TypeScript компиляция успешна
- [ ] ✅ Linting проходит
- [ ] ✅ Документация обновлена (см. этап 4.1)
- [ ] ✅ `npm run validate:quiet` проходит

---

## Критерии завершения

Этап считается завершенным, когда:

1. ✅ `npm run validate:quiet` проходит без ошибок
2. ✅ Все 455+ тестов проходят
3. ✅ TypeScript, ESLint, тесты - всё зелёное
4. ✅ Покрытие кода не снизилось
5. ✅ Ручная проверка нескольких tools подтверждает корректность

---

## Следующий шаг

После успешной валидации переходить к этапу **4.1_documentation_sequential.md**
