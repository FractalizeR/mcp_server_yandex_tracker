/**
 * Zod схемы для валидации параметра fields (фильтрация полей ответа)
 *
 * Ответственность (SRP):
 * - Валидация массива полей для фильтрации ответа
 * - Обеспечение типобезопасности для fields параметра
 *
 * Используется в MCP tools для указания, какие поля должны быть возвращены в ответе.
 * Это позволяет существенно уменьшить размер ответа и экономить контекст MCP.
 */

import { z } from 'zod';

/**
 * Валидация ОБЯЗАТЕЛЬНОГО массива полей для фильтрации ответа
 *
 * ВАЖНО: Этот параметр ОБЯЗАТЕЛЕН (не optional), чтобы гарантировать,
 * что вызывающая сторона явно указывает, какие поля ей нужны.
 * Это критично для экономии контекста MCP.
 *
 * Формат полей:
 * - Простые поля: 'id', 'name', 'status'
 * - Вложенные поля (dot-notation): 'assignee.login', 'queue.key'
 *
 * @example
 * // Правильно - массив из 1+ элементов
 * fields: ['id', 'name']
 * fields: ['key', 'assignee.login', 'status.key']
 *
 * // ОШИБКА - пустой массив не допускается
 * fields: []
 *
 * // ОШИБКА - undefined не допускается (поле обязательно)
 * // fields не указан
 */
export const FieldsSchema = z
  .array(z.string().min(1, 'Имя поля не может быть пустым'))
  .min(1, 'Параметр fields обязателен и должен содержать минимум 1 поле')
  .describe(
    'Список полей для возврата (ОБЯЗАТЕЛЬНЫЙ). ' +
      'Укажите минимум одно поле для экономии контекста MCP. ' +
      'Поддерживается dot-notation для вложенных полей (например: assignee.login).'
  );

/**
 * Вывод типа из схемы
 *
 * Результирующий тип: string[] (не undefined, не optional)
 */
export type Fields = z.infer<typeof FieldsSchema>;
